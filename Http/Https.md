# HTTPS (Hyper Text Transfer Protocol Secure)


## Https?

<hr>

    HTTP 프로토콜은 인터넷상에서 정보를 주고받는 프로토콜 입니다.
    HTTP 프로토콜이 데이터를 암호화하지 않은 일반 텍스트로 송수신하기 때문에 보안에 취약합니다.
    
    이를 보완한 프로토콜이 HTTPS 프로토콜이며, HTTPS는 HTTP 프로토콜로 송수신하는 일반 텍스트를
    SSL 또는 TLS 프로토콜을 통해 암호화하여 송수신합니다.

HTTPS는 HTTP에 데이터 암호화가 추가된 프로토콜이다.

HTTPS는 HTTP와 다르게 443번 포트를 사용하며, 
네트워크 상에서 중간에 제3자가 정보를 볼 수 없도록 암호화를 지원하고 있다.

## 대칭키와 비대칭키

<hr>

HTTPS의 보안 기능에 대해 이해하려면 먼저 대칭키와 비대칭키에 대한 이해가 필요하다.

키란 암호화를 진핼할 때 사용되는 비밀번호와 같은 역할을 한다. 이 키에 따라 암호화된 결과가 달라지기 때문에 키를 모르면 복호화 또한 할 수 없다.


### 대칭키

대칭키는 암호화에 사용되는 키와 복호화에 사용되는 키가 동일일 암호화 기법이다.

    예를 들어 암호화 전의 메세지를 키A를 통해 암호화를 진행했다면,
    암호화된 내용은 암호화를 사용할 때 사용된 키A를 통해 복호화 되는것도 가능한 기법이 대칭키이다.  

이 대칭키 방식에는 명확한 단점이 있는데 이 암호화와 복호화를 필요한 키의 공유가 어렵다는 것이다.
이러한 단점을 보완한 암호화 방식이 비대칭키 방식이다.

### 비대칭키

비대칭키 방식은 두개의 키를 갖게 되는데 A키를 사용해 암호화를 하면 B키로 복호화를 할수 있고, 
B키로 암호화를 하면 A키로 복호화를 할 수 있는 방식이다.

즉, 키A를 통해 암호화한 내용은 키A를 이용해 복호화 하는 것은 불가능하고 
키A와 쌍을 이루는 키B를 사용해야만 복호화가 가능하다.

이와 반대로 키B를 통해 암호화된 내용은 키B로 복호화하는 것은
불가능하고 키A를 통해서만 복호화가 가능하다.

이 방식에 착안해서 이 두개의 키 중 하나를 비공개키(private key, 개인키, 비밀키라고도 부른다)로 하여 자신만이 가지고 있고, 
나머지를 공개키로 지정하여 대중에게 공개한다.

클라이언트는 이 공개키를 사용하여 비밀번호화 같은 정보를 암호화 하여 서버에 보내면 서버는 자신이 보관하고 있던 비공개키를 사용하여, 
암호화된 내용을 복호화 할 수 있다.

![image](https://github.com/been1118/CS-Study/assets/123082067/0bf568d1-9231-43b5-8e85-d76a87298dcc)

이 과정에서 공개키가 유출이 된다고 해도 공개키를 이용해서는 오직 암호화만 가능하고 복호화는 오직 서버에서 보관중인 비밀키(비공개키)로만 가능하기 때문에 정보가 안전하다.

이 방식은 다른 방식으로도 응용이 가능한데, 
만약 공개키가 검증이 되었다면 이를 이용하여 암호화된 정보의 출처를 검증이 가능하다.

## HTTPS의 동작 과정

<hr>

HTTPS는 대칭키 암호화와 비대칭키 암호화를 모두 사용하여 빠른 연산 속도와 안정성을 모두 얻고 있다.

HTTPS 연결 과정(Hand-Shaking)에서는 먼저 서버와 클라이언트 간에 세션키를 교환한다. 
여기서 세션키는 주고 받는 데이터를 암호화하기 위해 사용되는 대칭키이며, 
데이터 간의 교환에는 빠른 연산 속도가 필요하므로 세션키는 대칭키로 만들어진다.

문제는 이 세션키를 클라이언트와 서버가 어떻게 교환할 것이냐 인데, 이 과정에서 비대칭키가 사용된다.

즉, 처음 연결을 성립하여 안전하게 세션키를 공유하는 과정에서 비대칭키가 사용되는 것이고, 이후에 데이터를 교환하는 과정에서 빠른 연산 속도를 위해 대칭키가 사용되는 것이다.

![image](https://github.com/been1118/CS-Study/assets/123082067/e77fd8dd-2c25-44c3-a68c-f1fe5841fd68)

실제 HTTPS 연결 과정이 성립되는 흐름을 살펴보면 다음과 같다.

1. 클라이언트(브라우저)가 서버로 최초 연결 시도를 함
2. 서버는 공개키(엄밀히는 인증서)를 브라우저에게 넘겨줌
3. 브라우저는 인증서의 유효성을 검사하고 세션키를 발급함
4. 브라우저는 세션키를 보관하며 추가로 서버의 공개키로 세션키를 암호화하여 서버로 전송함
5. 서버는 개인키로 암호화된 세션키를 복호화하여 세션키를 얻음
6. 클라이언트와 서버는 동일한 세션키를 공유하므로 데이터를 전달할 때 세션키로 암호화/복호화를 진행함

![image](https://github.com/been1118/CS-Study/assets/123082067/5c027ff9-1369-4c5c-82d4-809b53339f41)

## HTTPS의 발급 과정

<hr>

위의 과정에서 추가로 살펴봐야 할 부분은 서버가 비대칭키를 발급받는 과정이다. 
서버는 클라이언트와 세션키를 공유하기 위한 공개키를 생성해야 하는데, 일반적으로는 인증된 기관(Certificate Authority)에 공개키를 전송하여 인증서를 발급받는다. 
자세한 과정은 다음과 같다.

1. A기업은 HTTP 기반의 애플리케이션에 HTTPS를 적용하기 위해 공개키/개인키를 발급함
2. CA 기업에게 돈을 지불하고, 공개키를 저장하는 인증서의 발급을 요청함
3. CA 기업은 CA기업의 이름, 서버의 공개키, 서버의 정보 등을 기반으로 인증서를 생성하고, CA 기업의 개인키로 암호화하여 A기업에게 이를 제공함
4. A기업은 클라이언트에게 암호화된 인증서를 제공함
5. 브라우저는 CA기업의 공개키를 미리 다운받아 갖고 있어, 암호화된 인증서를 복호화함
6. 암호화된 인증서를 복호화하여 얻은 A기업의 공개키로 세션키를 공유함


![image](https://github.com/been1118/CS-Study/assets/123082067/e877e9d5-44a4-4ada-a56c-47e7293da516)


인증서는 CA의 개인키로 암호화되었기 때문에, 
신뢰성을 확보할 수 있고, 클라이언트는 A 기업의 공개키로 데이터를 암호화하였기 때문에
A기업만 복호화하여 원본의 데이터를 얻을 수 있다.

여기서 인증서에는 A 기업의 공개키가 포함되어 있으므로, A 기업의 공개키라고 봐도 무방하다. 

또한 브라우저에는 인증된 CA 기관의 정보들이 사전에 등록되어 있어 인증된 CA 기관의 인증서가 아닐 경우에는
다음과 같은 형태로 브라우저에서 보여지게 된다.

![image](https://github.com/been1118/CS-Study/assets/123082067/3ce50581-a98c-4011-9a5a-8d804cca6bcc)


    CA(Certificate Authority)
    위 인증서를 발급해주는 제 3자이다.
    브라우저는 신뢰할 수 있는 CA(공인 CA)들과 해당 CA의 공개키를 알고있다.

## SSL / TLS?

<hr>

SSL(Secure Scokets Layer)은 암호화 기반 인터넷 보안 프로토콜이다.
전달되는 모든 데이터를 암호화하고 특정한 유형의 사이버 공격도 차단한다.
SSL은 TLS(Transport Layer Security) 암호화의 전신이기도 한다.

SSL/TLS 를 사용하는 웹사이트 URL은 HTTP 대신 HTTPS가 사용된다.

SSL은 1996년 SSL 3.0 이후 업데이트되지 않았으며, 앞으로 사라지게 될 것으로 여기지고 있다.
또한 알려진 취약성이 여러가지 있으며 보안 전문가들은 SSL 사용 중단을 권장한다고 한다.
그 대안으로는 앞에서 언급한 TLS가 있다.

### 둘이 뭔 차인데?

TLS는 SSL의 업데이트 버전으로 SSL의 최종버전인 3.0과 TLS의 최초버전의 차이는 크지않으며,
이름이 바뀐것은 SSL을 개발한 Netscape가 업데이트에 참여하지 않게 되어 소유권 변경을 위해서였다고 한다.

결과적으로 TLS는 SSL의 업데이트 버전이며 명칭만 다르다고 볼 수 있다.

### 작동 방식

SSL은 개인정보 보호를 제공하기 위해, 웹에서 전송되는 데이터를 암호화 한다.
따라서, 데이터를 가로채려해도 거의 복호화가 불가능하다.

또, SSL은 클라이언트와 서버간에 핸드셰이크를 통해 인증이 이루어진다.
또한 데이터 무결성을 위해 데이터에 디지털 서명을 하여 데이터가 의도적으로 도착하기 전에 조작된 여부를 확인한다.

### 핸드셰이크

핸드셰이크는 클라이언트와 서버간의 메세지 교환이며,  HTTPS 웹에 처음 커넥션할 때 진행된다.
핸드셰이크의 단계는 클라이언트와 서버에서 지원하는 암호화 알고리즘, 키 교환 알고리즘에 따라 달라진다.

일반적으로는 RSA 키 교환 알고리즘이 사용된다.

    RSA 키 교환 알고리즘 순서

    1. 클라이언트 -> 서버 메세지 전송 - 이때 핸드셰이크가 시작된다. 이 메세지에는 TLS 버전, 암호화 알고리즘, 무작위 바이트 문자열이 포함된다.
    2. 서버 -> 클라이언트 메세지 전송 - 클라이언트의 메세지에 응답으로 서버의 SSL인증서, 선택한 암호화 알고리즘, 서버에서 생성한 무작위 바이트 문자열을 포함한 메세지를 전송한다.
    3. 인증 - 클라이언트가 서버의 SSL인증서를 인증 발행 기관에 검증한다.
    4. 예비 마스터 암호 - 클라이언트는 무작위 바이트 문자열을 공개 키로 암호화된 premater secret 키를 서버로 전송한다.
    5. 개인 키 사용 - 서버가 premaster secret 키를 개인 키를 통해 복호화한다. (개인 키로만 복호화 가능)
    6. 세션 키 생성 - 클라이언트와 서버는 클라이언트가 생성한 무작위 키, 서버가 생성한 무작위 키, premaster secret 키를 통해 세션 키를 생성한다. 양쪽은 같은 키가 생성되어야 한다.
    7. 클라이언트 완료 전송 - 클라이언트는 세션 키로 암호화된 완료 메세지를 전송한다.
    8. 서버 완료 전송 - 서버도 세션 키로 암호화된 완료 메세지를 전송한다.
    9. 핸드셰이크 완료 - 핸드셰이크가 완료되고, 세션 키를 이용해 통신을 진행한다.

### SSL/TLS 인증서

SSL은 SSL인증서(=TLS인증서)가 있는 웹사이트만 실행할 수 있다.
인증서는 사람의 신분증과 유사하다고 볼 수 있다.

SSL인증서에는 공개 키가 포함된다. 이 공개키 덕분에 암호화가 가능하게 된다.
클라이언트의 요청은 공개 키를 이용해 서버에 암호화 하여 전달한다.
서버에도 공개되지 않는 개인 키가 있는데 이 개인 키를 이용해 암호화된 데이터를 복호화한다.


## 정리

<hr>

HTTPS는 HTTP Secure 혹은 HTTP over SSL/TLS라고 부르고,
HTTP와 달리 HTTPS는 전송 데이터를 암호화한다.

HTTPS의 장점으로는
통신하고자 하는 서버가 신뢰할 수 있는 서버인지 판별할 수 있고,
통신 과정에서 데이터가 노출될 가능성이 적다.
